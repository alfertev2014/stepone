# Инкубатор

Проект по генерации идей путём попыток написания кода на языке, начиная со стандартной библиотеки.

## Система модулей

Прежде чем писать какой-то код, надо подразумевать некоторую модульную систему. Пока предполагается простейшая модульная система, которая в будущем может быть пересмотрена.

Каждый файл исходников является модулем.

При работе программы используется один экземпляр парсера с таблицей символов для парсинга всех модулей. Совпадение названий символов в разных модулях означает совпадение самих символов при выполнении программы. Для простоты считаем, что при выполнении программы используется один парсер.

Каждый модуль исполняется в одном и том же контексте. Контекст содержит базовый контекст, предоставляемый средой исполнения со всеми встроенными  функциями, типами и расширениями. Также, контекст загрузки модулей содержит дополнительные значения для импорта и экспорта символов модулей. Контекст загрузки модулей является реализацией модульной системы.

Дополнительным символом модульной системы является символ import - получение объекта модуля по его ID.
Синтаксис импорта:

    import module-id module-object . rest-of-module

Где module-id - идентификатор модуля, module-object - символ, с которым связывается объект импортированного модуля, rest-of-module - другие выражения в модуле, выполняемые в контексте, к которому добавлен символ module-object.

Идентификатор модуля - это строка, с помощью которой можно обнаружить текстовый файл модуля, например, в файловой системе. Правила поиска текстовый файлов модуля определяются реализацией модульной системы.

Вызов import не сразу вызывает выполнение rest-of-module, а возвращает отложенное вычисление, которое может быть продолжено модульной системой. Это сделано для решения проблемы взаимозависимых модулей.

Каждый модуль проходит следующие стадии:
* чтение файла - текстовый файл модуля читается в память и передаётся парсеру
* парсинг - текстовая последовательность модуля преобразуется в исходник-дерево
* вычисление - запуск исходника в контексте загрузки модулей.

Каждый объект модуля является синглтоном. Запуск исходника модуля в контексте загрузчика модулей может вернуть не готовый модуль, а отложенное вычисление как запрос на загрузку модуля-зависимости. Пока предполагается, что import может вызываться только на верхнем уровне, чтобы его результат был интерпретирован правильно системой модулей. При желании можно использовать соответствующую реализацию continuations.

Процесс запуска программы начинается с загрузки главного модуля. Система модуей в цикле вычисляет возвращаемые этим модулем отложенные вычисления и догружает другие модули-зависимости. Все вычисленные до конца модули собираются в единый реестр - мапа с ключами-идентификаторами модулей.

