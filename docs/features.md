# Описание Языка

Сущность Языка можно грубо разделить на несколько слоёв. Каждый слой требует стандартизации, чтобы он имел одинаковую структуру и поведение на множестве различных платформ. При этом слои можно использовать по отдельности, поверх одного слоя можно наложить другой с альтернативным стандартом. Чем ниже слой, тем более жёсткий стандарт. Верхние слои близки к пользовательскому коду и могут быть заменены при желании альтернативным стандартом.

Слои, которые можно выделить для стандартизации:

* Объекты AST и семантика их интерпретации
* Типы-расширения и API создания расширений для конкретной платформы
* Конкретный (строковый) синтаксис исходников
* Содержимое контекста базового интерпретатора
* Система модулей
* Слои стандартной библиотеки

## Абстрактный синтаксис и семантика

Синтаксис Языка имеет два вида. _Абстрактный синтаксис_ описывает правила построения древовидных структур, представляющих программы, а _конкретный синтаксис_ предназначен для выражения программ в виде символьных строк. Исходный код в конкретном синтаксисе может быть транслирован в представление с абстрактным синтаксисом с помощью _парсера_.

Слои абстрактного и конкретного синтаксиса полностью независимы друг от друга. Связь между ними выражается парсером. Возможно построение рантайма Языка для исполнения программ в абстрактном синтаксисе без необходимости формировать строки в конкретном синтаксисе. Платформа может позволять напрямую формировать программы в абстрактном синтаксисе и подавать их на интерпретацию рантайму. Используя парсер можно использовать рантайм для исполнения программ, написанных в конкретном синтаксисе. Возможно построение такого рантайма, который непосредственно исполняет программы в конкретном синтаксисе.

_Абстрактрое синтаксическое дерево_ (AST) является представлением программ на Языке в абстрактном синтаксисе. Оно состоит из узлов из ограниченного набора типов. Каждый узел далее называется просто _объектом_.

_Исходником_ на Языке будет называться любой фрагмент AST, предназначенный для выполнения в некотором _контексте_. Контекст выполнения исходника задаётся средой исполнения и другими фрагментами исходников.

### Объекты AST

Все объекты AST исходников представляются расположенными в некоторой области абстрактной _памяти_. Память может быть неограничена, но в зависимости от платформы могут быть ограничения на размер. Объекты, расположенные в разных местах памяти, считаются различными. Два объекта считаются совпадающими, если они являются одним и тем же объектом в памяти. Таким образом, расположение объекта в памяти является его идентифицирующим свойством.

Адрес расположения объекта в памяти называется _ссылкой_ (Reference). Ссылка содержит данные для обращения к объекту, на который она указывает. Она может быть частью данных других объектов. Для ссылок определена операция проверки на равенство. Ссылки считаются равными, если указывают на один и тот же объект в памяти.

Узлы AST делятся на две группы: промежуточные и листовые. Промежуточные узлы служат лишь для группировки и формирования структуры дерева, но не содержат никаких других полезных данных. Листовые узлы могут быть различных типов: примитивные значения, символьные константы, объекты с исполяемым кодом, объекты расширений платформы со сложным поведением.

К любому объекту могут быть применены операции _вычисления_ (eval), и _применения_ его к другому объекту (apply). Обе эти операции выполняются в определённом контексте вычисления. Результатом вычисления может быть другой объект или один из уже существующих в памяти. Кроме результата у операции может быть побочный эффект, зависящий от реализации среды исполнения на платформе.

### Основные типы объектов

Промежуточные узлы AST называются _парами_. Остальные типы объектов являются листовыми и называются _атомами_. Пары - это единственный способ представления составных структур исходников, встроенный в базовый язык. С помощью пар все исходники и данные в памяти программы организуются в бинарные деревья. Атомы предполагаются неделелимыми с точки зрения AST и выполнения программ. Внутреннее устройство атомов скрыто в деталях реализации на платформе.

Пара (Pair) - это объект из двух полей car и cdr, являющихся ссылками на другие объекты. Для пар существуют операции _конструирования_ пары из двух объектов - cons, и операции _получения_ первого и второго элементов пары - car и cdr. Хотя среди атомов тоже могут быть объекты, объединяющие другие объекты в сложные структуры, пары имеют особое значение с точки зрения интерпретации.

Остальные объекты являются атомами. Атомы делятся на две группы: _символы_ и _константы_. Они отличаются своей интерпретацией в ходе вычисления.

Символы (Symbol) - это атомы, служащие для именования других объектов. Символ представляет собой идентификатор, предназначенный только для проверки на совпадение с другим символом. Результат вычисления символа зависит от контекста вычисления. В контексте вычисления хранятся соответствия символов их значениям. Символы используются в контексте как ключи.

Константа (Const) - это атом, результатом вычисления которого является он сам (тот же объект в памяти). Константы делятся на группы по поведению при операции применения.

Среди констант выделяется особая группа - _значения_. Значение (Value), как и константа, в результате своего вычисления возвращает само себя. Также, значение возвращает само себя как результат применения его к чему-либо. Остальные константы являются _макросами_. Значениями являются числа, строки, логические константы, векторы, массивы.

Макрос (Macro) - это объект, который может иметь сложное поведение как результат своего применения другим объектам.

### Правила интерпретации


## API создания расширений


## Конкретный синтаксис

### S-выражения

### Парсер


## Базовый контекст




## Система модулей




## Cтандартная библиотека

